sequenceDiagram
    autonumber
    actor C as Client
    participant ZAC as ZoneAmenityController
    participant ZAS as ZoneAmenityService
    participant ZS as ZoneService
    participant AS as AmenityService
    participant ZAV as ZoneAmenityValidator
    participant ZAB as ZoneAmenityBuilder
    participant ZAR as ZoneAmenityRepository

    C ->> ZAC: POST /zone-amenities { "zone_id": "uuid", "amenity_id": "uuid" }
    activate ZAC

    ZAC ->> ZAS: createZoneAmenity(request)
    activate ZAS

    ZAS ->> ZAV: validateRequest(request)
    activate ZAV
    alt Request Validation Failed
        ZAV --x ZAS: throw ValidationException
        ZAS --x ZAC: throw ValidationException
        ZAC -->> C: HTTP 400 Bad Request
    else Request Validation Passed
        ZAV -->> ZAS: validation result
        deactivate ZAV

        ZAS ->> ZS: getZoneById(request.zone_id)
        activate ZS
        alt Zone Not Found
            ZS --x ZAS: throw ZoneNotFoundException
            ZAS --x ZAC: throw ZoneNotFoundException
            ZAC -->> C: HTTP 404 Not Found
        else Zone Found
            ZS -->> ZAS: zone
            deactivate ZS

            ZAS ->> AS: getAmenityById(request.amenity_id)
            activate AS
            alt Amenity Not Found
                AS --x ZAS: throw AmenityNotFoundException
                ZAS --x ZAC: throw AmenityNotFoundException
                ZAC -->> C: HTTP 404 Not Found
            else Amenity Found
                AS -->> ZAS: amenity
                deactivate AS

                ZAS ->> ZAR: findByZoneIdAndAmenityId(zone_id, amenity_id)
                activate ZAR
                alt Already Exists
                    ZAR --x ZAS: throw DuplicateZoneAmenityException
                    ZAS --x ZAC: throw DuplicateZoneAmenityException
                    ZAC -->> C: HTTP 409 Conflict
                else Not Found
                    ZAR -->> ZAS: null
                    deactivate ZAR

                    ZAS ->> ZAB: buildZoneAmenity(zone, amenity)
                    activate ZAB
                    ZAB -->> ZAS: newZoneAmenity
                    deactivate ZAB

                    ZAS ->> ZAR: save(newZoneAmenity)
                    activate ZAR
                    ZAR -->> ZAS: savedZoneAmenity
                    deactivate ZAR

                    ZAS -->> ZAC: ZoneAmenityResponse
                    deactivate ZAS
                    ZAC -->> C: HTTP 201 Created (ZoneAmenityResponse)
                    deactivate ZAC
                end
            end
        end
    end