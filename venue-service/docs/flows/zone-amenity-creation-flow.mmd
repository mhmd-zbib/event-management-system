graph TD
%% Main Flow
    Start([Start]) -->|POST /zone-amenities| ValidateRequest{Validate Request}
    ValidateRequest -->|Invalid| HandleError[Return 400 Bad Request]

    ValidateRequest -->|Valid| CheckZone{Check Zone Exists}
    CheckZone -->|Not Found| HandleZoneError[Return 404 Zone Not Found]

    CheckZone -->|Found| ValidateAmenities{Validate Amenity Array}
    ValidateAmenities -->|Invalid| HandleAmenityError[Return 400 Bad Request]

    ValidateAmenities -->|Valid| CheckAmenities[Check All Amenities Exist]
    CheckAmenities -->|Not Found| HandleNotFoundError[Return 404 Amenities Not Found]

    CheckAmenities -->|All Found| FilterDuplicates[Filter Out Existing Assignments]
    FilterDuplicates --> CreateAssignments[Create New Zone Amenities]
    CreateAssignments --> SaveBatch[Save Batch to Database]
    SaveBatch --> Success([Return 201 Created])

%% Style Definitions
    classDef start_end fill:#e3f2fd,stroke:#1976d2,color:black
    classDef process fill:#f5f5f5,stroke:#424242,color:black
    classDef validation fill:#fff3e0,stroke:#f57c00,color:black
    classDef error fill:#ffebee,stroke:#c62828,color:black

%% Apply Styles
    class Start,Success start_end
    class FilterDuplicates,CreateAssignments,SaveBatch,CheckAmenities process
    class ValidateRequest,ValidateAmenities,CheckZone validation
    class HandleError,HandleZoneError,HandleAmenityError,HandleNotFoundError error