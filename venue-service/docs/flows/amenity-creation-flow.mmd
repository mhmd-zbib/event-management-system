graph TD
%% Main Flow
    Start([Start]) -->|POST /amenities| ValidateAmenity{Validate Amenity}
    ValidateAmenity -->|Invalid| HandleError[Return 400 Bad Request]
    ValidateAmenity -->|Valid| CheckCategory[Check Category Exists]

    CheckCategory -->|Not Found| HandleCategoryError[Return 404 Not Found]
    CheckCategory -->|Found| CreateAmenity[Create Amenity]
    CreateAmenity --> SaveAmenity[Save to Database]

%% Icon Processing
    SaveAmenity --> ValidateIcon{Validate Icon}
    ValidateIcon -->|Invalid| HandleIconError[Return 400 Bad Request]
    ValidateIcon -->|Valid| ProcessIcon[Process Icon]
    ProcessIcon --> SaveIcon[Save Icon to Storage]
    SaveIcon --> Success([Return 201 Created])

%% Style Definitions
    classDef start_end fill:#e3f2fd,stroke:#1976d2,color:black
    classDef process fill:#f5f5f5,stroke:#424242,color:black
    classDef validation fill:#fff3e0,stroke:#f57c00,color:black
    classDef error fill:#ffebee,stroke:#c62828,color:black

%% Apply Styles
    class Start,Success start_end
    class CreateAmenity,SaveAmenity,ProcessIcon,SaveIcon,CheckCategory process
    class ValidateAmenity,ValidateIcon validation
    class HandleError,HandleIconError,HandleCategoryError error